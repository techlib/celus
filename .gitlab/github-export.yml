github_push:
  stage: push
  before_script:
    - export GIT_SSH_COMMAND="ssh -i $CELUS_GITHUB_PUSH_KEY"
    - chmod 0600 "$CELUS_GITHUB_PUSH_KEY"
    - apt-get update
    - apt-get -y upgrade
    - apt-get -y install --no-install-recommends git openssh-client
    - mkdir -p ~/.ssh/
    - ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts
  script:
    - git remote add github "${CELUS_GITHUB_REPO}" || true
    - git fetch github
    - git log -1 --oneline
    - git branch -v
    - git log -1 --oneline
    - echo "BRANCH $CI_COMMIT_BRANCH"
    - git log --decorate=full --oneline HEAD...github/"$CI_COMMIT_BRANCH"^
    - git push github HEAD:refs/heads/"$CI_COMMIT_BRANCH"
  rules:
    - if: $CI_COMMIT_BRANCH == "master" || $CI_COMMIT_BRANCH == "staging" || $CI_COMMIT_BRANCH == "devel"
      when: always
    - when: never
  tags:
    - bdd
